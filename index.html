<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindAR with Three.js - Multi-Target Example</title>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            // Inicializa el contexto de MindAR y Three.js
            const mindarThree = new window.MINDAR.IMAGE.MindARThree({
                container: document.body,
                imageTargetSrc: 'Target/targets.mind' // Reemplaza con la ruta de tu archivo .mind
            });
            const { renderer, scene, camera } = mindarThree;

            // Array para almacenar los grupos de objetos, uno por cada target
            const objects = [];

            // Configura 5 targets con primitivas 3D diferentes
            const geometries = [
                new THREE.BoxGeometry(0.5, 0.5, 0.5),     // Cubo
                new THREE.SphereGeometry(0.3, 32, 32),    // Esfera
                new THREE.ConeGeometry(0.3, 0.5, 32),     // Cono
                new THREE.CylinderGeometry(0.3, 0.5, 32), // Cilindro
                new THREE.TorusGeometry(0.3, 0.1, 16, 100) // Toro
            ];

            geometries.forEach((geometry, i) => {
                const material = new THREE.MeshBasicMaterial({ color: Math.random() * 0xffffff });
                const mesh = new THREE.Mesh(geometry, material);
                
                // Crear un grupo para cada target y aÃ±adir el objeto 3D
                const group = new THREE.Group();
                group.add(mesh);
                group.visible = false; // Inicialmente invisible hasta que se detecte el target
                scene.add(group);
                objects.push(group);

                // Vincula cada target con su objeto 3D correspondiente
                mindarThree.controller.onTargetFound = (targetIndex) => {
                    if (targetIndex === i) {
                        group.visible = true;
                    }
                };

                mindarThree.controller.onTargetLost = (targetIndex) => {
                    if (targetIndex === i) {
                        group.visible = false;
                    }
                };
            });

            // Inicia MindAR y el bucle de renderizado
            await mindarThree.start();
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        });
    </script>
</body>
</html>
